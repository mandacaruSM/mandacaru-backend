# ----------------------------------------------------------------
# 9. TEMPLATE DO DASHBOARD
# backend/apps/almoxarifado/templates/admin/almoxarifado/dashboard.html
# ----------------------------------------------------------------

"""
{% extends "admin/base_site.html" %}
{% load admin_static %}

{% block title %}{{ title }} | {{ site_title|default:"Django site admin" }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">Home</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label='almoxarifado' %}">Almoxarifado</a>
    &rsaquo; Dashboard
</div>
{% endblock %}

{% block content %}
<style>
    .estoque-card {
        border-radius: 8px;
        padding: 20px;
        min-width: 200px;
    }
    .estoque-card.baixo {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
    }
    .estoque-card.ok {
        background: #d1edff;
        border: 1px solid #b3d7ff;
    }
    .estoque-card.baixo .valor {
        color: #e17055;
    }
    .estoque-card.ok .valor {
        color: #00b894;
    }
</style>
<h1>üè™ {{ title }}</h1>

<!-- Cart√µes de Estat√≠sticas -->
<div style="display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap;">
    
    <!-- Total de Combust√≠veis -->
    <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; min-width: 200px;">
        <h3 style="margin: 0; color: #495057;">‚õΩ Combust√≠veis</h3>
        <p style="font-size: 24px; font-weight: bold; margin: 10px 0; color: #007bff;">
            {{ estatisticas.total_combustiveis }}
        </p>
        <small style="color: #6c757d;">Total cadastrados</small>
    </div>
    
    <!-- Estoque Baixo -->
    {% with com_estoque_baixo=estatisticas.com_estoque_baixo|default:0 %}
    <div class="estoque-card {% if com_estoque_baixo > 0 %}baixo{% else %}ok{% endif %}">
        <h3 style="margin: 0; color: #495057;">üö® Estoque Baixo</h3>
        <p class="valor" style="font-size: 24px; font-weight: bold; margin: 10px 0;">
            {{ com_estoque_baixo }}
        </p>
        <small style="color: #6c757d;">Precisam reposi√ß√£o</small>
    </div>
    {% endwith %}
    
    <!-- Valor Total do Estoque -->
    <div style="background: #e8f5e8; border: 1px solid #c3e6c3; border-radius: 8px; padding: 20px; min-width: 200px;">
        <h3 style="margin: 0; color: #495057;">üí∞ Valor Estoque</h3>
        <p style="font-size: 24px; font-weight: bold; margin: 10px 0; color: #00b894;">
            R$ {{ estatisticas.valor_total_estoque|floatformat:2 }}
        </p>
        <small style="color: #6c757d;">Valor total investido</small>
    </div>
    
    <!-- Abastecimentos 30 dias -->
    <div style="background: #fff0f6; border: 1px solid #ffb3d9; border-radius: 8px; padding: 20px; min-width: 200px;">
        <h3 style="margin: 0; color: #495057;">üìä √öltimos 30 dias</h3>
        <p style="font-size: 18px; font-weight: bold; margin: 10px 0; color: #e84393;">
            {{ estatisticas.abastecimentos_30_dias }} abastecimentos<br>
            {{ estatisticas.litros_30_dias|floatformat:1 }}L
        </p>
        <small style="color: #6c757d;">R$ {{ estatisticas.valor_30_dias|floatformat:2 }}</small>
    </div>
</div>

<!-- Alertas de Estoque Baixo -->
{% if alertas_estoque %}
<div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 20px; margin-bottom: 30px;">
    <h2 style="color: #e17055; margin-top: 0;">üö® Alertas de Estoque Baixo</h2>
    
    <div style="display: grid; gap: 15px;">
        {% for estoque in alertas_estoque %}
        <div style="background: white; border: 1px solid #ffeaa7; border-radius: 6px; padding: 15px; 
                    display: flex; justify-content: between; align-items: center;">
            <div>
                <strong>{{ estoque.tipo_combustivel.nome }}</strong><br>
                <span style="color: #e17055;">
                    üìä Atual: {{ estoque.quantidade_em_estoque }}L | 
                    ‚ö†Ô∏è M√≠nimo: {{ estoque.estoque_minimo }}L
                </span>
            </div>
            <div style="text-align: right;">
                <span style="background: #e17055; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                    URGENTE
                </span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Estoque Atual -->
<div style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin-bottom: 30px;">
    <h2 style="margin-top: 0;">üì¶ Estoque Atual de Combust√≠veis</h2>
    
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f8f9fa;">
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Combust√≠vel</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #dee2e6;">Estoque Atual</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #dee2e6;">Estoque M√≠nimo</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #dee2e6;">Status</th>
                <th style="padding: 12px; text-align: right; border-bottom: 2px solid #dee2e6;">Valor Total</th>
            </tr>
        </thead>
        <tbody>
            {% for estoque in estoques %}
            <tr style="border-bottom: 1px solid #dee2e6;">
                <td style="padding: 12px;">
                    <strong>{{ estoque.tipo_combustivel.nome }}</strong><br>
                    <small style="color: #6c757d;">R$ {{ estoque.valor_compra }}/L</small>
                </td>
                <td style="padding: 12px; text-align: center; font-weight: bold;">
                    {{ estoque.quantidade_em_estoque }}L
                </td>
                <td style="padding: 12px; text-align: center;">
                    {{ estoque.estoque_minimo }}L
                </td>
                <td style="padding: 12px; text-align: center;">
                    {% if estoque.abaixo_do_minimo %}
                        <span style="background: #e17055; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                            üö® BAIXO
                        </span>
                    {% else %}
                        <span style="background: #00b894; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                            ‚úÖ OK
                        </span>
                    {% endif %}
                </td>
                <td style="padding: 12px; text-align: right; font-weight: bold;">
                    R$ {% widthratio estoque.quantidade_em_estoque 1 estoque.valor_compra as valor_total %}{{ valor_total|floatformat:2 }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Top Equipamentos -->
{% if top_equipamentos %}
<div style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
    <h2 style="margin-top: 0;">üèÜ Top Equipamentos (√öltimos 30 dias)</h2>
    
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f8f9fa;">
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Equipamento</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #dee2e6;">Total Litros</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #dee2e6;">Abastecimentos</th>
            </tr>
        </thead>
        <tbody>
            {% for equip in top_equipamentos %}
            <tr style="border-bottom: 1px solid #dee2e6;">
                <td style="padding: 12px;">
                    <strong>{{ equip.equipamento__nome }}</strong>
                </td>
                <td style="padding: 12px; text-align: center; font-weight: bold; color: #007bff;">
                    {{ equip.total_litros|floatformat:1 }}L
                </td>
                <td style="padding: 12px; text-align: center;">
                    {{ equip.total_abastecimentos }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- A√ß√µes R√°pidas -->
<div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
    <h3>‚ö° A√ß√µes R√°pidas</h3>
    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
        <a href="{% url 'admin:almoxarifado_estoquecombustivel_changelist' %}" 
           style="background: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 6px;">
            üì¶ Gerenciar Estoques
        </a>
        <a href="{% url 'admin:abastecimento_registroabastecimento_changelist' %}?origem_combustivel=ALMOXARIFADO" 
           style="background: #28a745; color: white; padding: 10px 20px; text-decoration: none; border-radius: 6px;">
            üìä Ver Abastecimentos
        </a>
        <a href="{% url 'admin:almoxarifado_movimentacaoestoque_changelist' %}" 
           style="background: #ffc107; color: black; padding: 10px 20px; text-decoration: none; border-radius: 6px;">
            üìà Movimenta√ß√µes
        </a>
    </div>
</div>

{% endblock %}
"""
